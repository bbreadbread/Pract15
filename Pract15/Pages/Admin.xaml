<Page x:Class="Pract15.Pages.Admin"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Pract15.Pages"
      xmlns:models="clr-namespace:Pract15.Models"
      xmlns:services="clr-namespace:Pract15.Service"
      xmlns:validators="clr-namespace:Pract15.ValidationRules"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      mc:Ignorable="d"
      DataContext="{Binding RelativeSource={RelativeSource Self}}"
      Title="Каталог" d:DesignHeight="750" d:DesignWidth="1100" Loaded="LoadList">


    <Page.Resources>
        <services:CategoriesService x:Key="catService"/>
        <services:BrandsService    x:Key="brdService"/>
    </Page.Resources>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="450"/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="40"/>
            <RowDefinition Height="120"/>
            <RowDefinition/>
            <RowDefinition Height="40"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Админ" Style="{StaticResource Title}" Grid.ColumnSpan="3"/>
        
        <Button x:Name="ButtonToAdminPage" Content="&lt; Вернуться в каталог" Grid.Column="0" Style="{StaticResource AdminBut}" Click="ButtonToMagazinePage_Click"/>
        
        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Center">
            <Button Click="Product_Click">
                <TextBlock Text="Работа с товарами" Style="{DynamicResource WHITE}"/>
            </Button>
            <Button Click="Category_Click" Width="300">
                <TextBlock Text="Работа с категориями" Style="{DynamicResource WHITE}"/>
            </Button>
            <Button Click="Tag_Click">
                <TextBlock Text="Работа с тегами" Style="{DynamicResource WHITE}"/>
            </Button>
            <Button Click="Brand_Click">
                <TextBlock Text="Работа с брендами" Style="{DynamicResource WHITE}"/>
            </Button>
        </StackPanel>
        <Grid Grid.Row="2" Grid.Column="0" Style="{StaticResource backGrid}">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition Height="8*"/>
                <RowDefinition/>
                <RowDefinition/>
            </Grid.RowDefinitions>

            

            <WrapPanel x:Name="GeneratedPenel" Orientation="Vertical" Grid.ColumnSpan="2">

                <StackPanel x:Name="ProductPanel" Orientation="Vertical" Visibility="Visible"
                             DataContext="{Binding _product}">
                    <StackPanel>
                        <TextBlock Style="{DynamicResource WHITE}" Text="Название:"/>
                        <TextBox x:Name="tbName">
                            <TextBox.Text>
                                <Binding Path="Name">
                                    <Binding.ValidationRules>
                                        <validators:MainValidation/>
                                    </Binding.ValidationRules>
                                </Binding>
                            </TextBox.Text>
                        </TextBox>
                    </StackPanel>

                    <StackPanel>
                        <TextBlock Style="{DynamicResource WHITE}" Text="Описание:"/>
                        <TextBox x:Name="tbDescription">
                            <TextBox.Text>
                                <Binding Path="Description">
                                    <Binding.ValidationRules>
                                        <validators:MainValidation/>
                                    </Binding.ValidationRules>
                                </Binding>
                            </TextBox.Text>
                        </TextBox>
                    </StackPanel>

                    <StackPanel>
                        <TextBlock Style="{DynamicResource WHITE}" Text="Цена:"/>
                        <TextBox x:Name="tbPrice">
                            <TextBox.Text>
                                <Binding Path="Price">
                                    <Binding.ValidationRules>
                                        <validators:NumberValidation/>
                                    </Binding.ValidationRules>
                                </Binding>
                            </TextBox.Text>
                        </TextBox>
                    </StackPanel>

                    <StackPanel>
                        <TextBlock Style="{DynamicResource WHITE}" Text="Остаток:"/>
                        <TextBox x:Name="tbStock">
                            <TextBox.Text>
                                <Binding Path="Stock">
                                    <Binding.ValidationRules>
                                        <validators:NumberValidation/>
                                    </Binding.ValidationRules>
                                </Binding>
                            </TextBox.Text>
                        </TextBox>
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock Style="{DynamicResource WHITE}">Категория:</TextBlock>
                        <ComboBox DisplayMemberPath="Name"
                                  SelectedValuePath="Id"
                                  x:Name="cbCat"
                                  SelectedValue="{Binding CategoryId}"
                                  ItemsSource="{Binding Source={StaticResource catService}, Path=Items}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock Style="{DynamicResource WHITE}">Бренд:</TextBlock>
                        <ComboBox DisplayMemberPath="Name"
                                  SelectedValuePath="Id"
                                  x:Name="cbBrand"
                                  SelectedValue="{Binding BrandId}"
                                  ItemsSource="{Binding Source={StaticResource brdService}, Path=Items}"/>
                    </StackPanel>
                    
                    <Button Style="{StaticResource CRUD}" Click="EditTagsClick" Width="300">
                        <TextBlock Text="Редактирование тегов" Style="{DynamicResource WHITE}"/>
                    </Button>
                </StackPanel>

                <StackPanel x:Name="CategoryPanel" Orientation="Vertical" Visibility="Collapsed"
                             DataContext="{Binding _category}">
                    <TextBlock Style="{DynamicResource WHITE}" Text="Название:"/>
                    <TextBox x:Name="tbNameCat">
                        <TextBox.Text>
                            <Binding Path="Name" Mode="TwoWay">
                                <Binding.ValidationRules>
                                    <validators:NameCategoriesValidation/>
                                </Binding.ValidationRules>
                            </Binding>
                        </TextBox.Text>
                    </TextBox>
                </StackPanel>

                <StackPanel x:Name="TagPanel" Orientation="Vertical" Visibility="Collapsed"
                             DataContext="{Binding _tag}">
                    <TextBlock Style="{DynamicResource WHITE}" Text="Название:"/>
                    <TextBox x:Name="tbNameTag">
                        <TextBox.Text>
                            <Binding Path="Name" Mode="TwoWay">
                                <Binding.ValidationRules>
                                    <validators:NameTagsValidation/>
                                </Binding.ValidationRules>
                            </Binding>
                        </TextBox.Text>
                    </TextBox>
                </StackPanel>

                <StackPanel x:Name="BrandPanel" Orientation="Vertical" Visibility="Collapsed"
                             DataContext="{Binding _brand}">
                    <TextBlock Style="{DynamicResource WHITE}" Text="Название:"/>
                    <TextBox x:Name="tbNameBrand">
                        <TextBox.Text>
                            <Binding Path="Name" Mode="TwoWay">
                                <Binding.ValidationRules>
                                    <validators:NameBrandsValidation/>
                                </Binding.ValidationRules>
                            </Binding>
                        </TextBox.Text>
                    </TextBox>
                </StackPanel>
            </WrapPanel>
            <Button Grid.Row="1" Grid.Column="0" Style="{StaticResource CRUD}" Click="SaveClick">
                <TextBlock Style="{DynamicResource WHITE}" Text="Изменить"/>
            </Button>

            <Button Grid.Row="1" Grid.Column="1" Style="{StaticResource CRUD}" Click="AddClick">
                <TextBlock Text="Добавление" Style="{DynamicResource WHITE}"/>
            </Button>

            <Button Grid.Row="2" Grid.ColumnSpan="2" Style="{StaticResource CRUD}" Width="440" Click="RemoveClick">
                <TextBlock Text="Удаление выбранного" Style="{DynamicResource WHITE}"/>
            </Button>

        </Grid>
        <materialDesign:ColorZone Grid.Row="2" Grid.Column="1" Mode="SecondaryMid">
            <ListView Grid.Row="1" Grid.Column="1" Name="FormsList" ItemsSource="{Binding Items}" HorizontalContentAlignment="Stretch"
                      SelectedItem="{Binding selectedItem}" MouseDoubleClick="FormsList_SelectDoubleClick">
                <ListView.Resources>
                    <DataTemplate DataType="{x:Type models:Product}">
                        <Border x:Name="ProductBorder"
                                Style="{StaticResource Stock}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding Name}" Style="{StaticResource WHITE}"/>
                                    <TextBlock Style="{StaticResource WHITE}">
                                        <Run Text="★ "/>
                                        <Run Text="{Binding Rating}"/>
                                    </TextBlock>

                                    <TextBlock Style="{StaticResource WHITE}">
                                         <Run Text="{Binding Category.Name}"/>
                                    </TextBlock>

                                    <TextBlock Style="{StaticResource WHITE}">
                                        <Run Text="{Binding Description}"/>
                                    </TextBlock>

                                    <ItemsControl ItemsSource="{Binding ProductTags}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Horizontal" Background="{StaticResource MainAccent}"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Style="{StaticResource WHITE}">
                                                     <Run Text="#"/>
                                                     <Run Text="{Binding Tag.Name}"/>
                                                     <Run Text=" "/>
                                                </TextBlock>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                                <StackPanel Grid.Column="1">
                                    <TextBlock HorizontalAlignment="Right" Style="{StaticResource WHITE}">
                                        <Run Text="{Binding Price}"/>
                                        <Run Text=" Рублей"/>
                                    </TextBlock>
                                    <TextBlock HorizontalAlignment="Right" Style="{StaticResource WHITE}">
                                        <Run Text="Остаток "/>
                                        <Run Text="{Binding Stock}"/>
                                    </TextBlock>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <DataTemplate.Triggers>
                            <DataTrigger Binding="{Binding Stock}" Value="9">
                                <Setter TargetName="ProductBorder" Property="BorderBrush" Value="{StaticResource BalanceBorder}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="8">
                                <Setter TargetName="ProductBorder" Property="BorderBrush" Value="{StaticResource BalanceBorder}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="7">
                                <Setter TargetName="ProductBorder" Property="BorderBrush" Value="{StaticResource BalanceBorder}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="6">
                                <Setter TargetName="ProductBorder" Property="BorderBrush" Value="{StaticResource BalanceBorder}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="5">
                                <Setter TargetName="ProductBorder" Property="BorderBrush" Value="{StaticResource BalanceBorder}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="4">
                                <Setter TargetName="ProductBorder" Property="BorderBrush" Value="{StaticResource BalanceBorder}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="3">
                                <Setter TargetName="ProductBorder" Property="BorderBrush" Value="{StaticResource BalanceBorder}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="2">
                                <Setter TargetName="ProductBorder" Property="BorderBrush" Value="{StaticResource BalanceBorder}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="1">
                                <Setter TargetName="ProductBorder" Property="BorderBrush" Value="{StaticResource BalanceBorder}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="0">
                                <Setter TargetName="ProductBorder" Property="BorderBrush" Value="{StaticResource BalanceBorder}"/>
                            </DataTrigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type models:Category}">
                        <TextBlock Text="{Binding Name}" Style="{StaticResource WHITE}"/>
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type models:Tag}">
                        <TextBlock Text="{Binding Name}" Style="{StaticResource WHITE}"/>
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type models:Brand}">
                        <TextBlock Text="{Binding Name}" Style="{StaticResource WHITE}"/>
                    </DataTemplate>
                </ListView.Resources>
            </ListView>
        </materialDesign:ColorZone>
        <WrapPanel Grid.Row="3" Grid.ColumnSpan="2">
            <TextBlock Style="{StaticResource WHITE}" Text="{Binding Items.Count, ElementName=FormsList, StringFormat='{} Записей: {0}'}"/>
        </WrapPanel>    </Grid>
</Page>
